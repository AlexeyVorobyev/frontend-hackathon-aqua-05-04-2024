import {FC, useEffect, useState} from 'react'
import {AlexIcon} from '../../../../shared-react-components/alex-icon/alex-icon.component.tsx'
import {MarkerEnchanced} from './marker-enchanced.component.tsx'
import {Button, useTheme} from '@mui/material'
import {Marker} from 'react-leaflet'
import {useReactiveVar} from '@apollo/client'
import {pickedPlaceId} from '../../../../core/apollo/vars.ts'

export enum EMarkerType {
    external = 'external'
}

export interface IPlaceMarkerProps {
    id: string
    name: string
    coordinates: {
        lat: number
        lon: number
    }
    markerType: EMarkerType
    handleOnClick?: (id: string) => void
}

export const PlaceMarker: FC<IPlaceMarkerProps> = ({
                                                       id,
                                                       name,
                                                       coordinates,
                                                       markerType,
                                                       handleOnClick,
                                                   }) => {
    const pickedPlaceIdVar = useReactiveVar(pickedPlaceId)
    const theme = useTheme()
    const [active, setActive] = useState<boolean>(false)

    useEffect(() => {
        setActive(pickedPlaceIdVar === id)
    }, [pickedPlaceIdVar])

    return (
        <MarkerEnchanced
            eventHandlers={{
                click: () => {
                    pickedPlaceId(id)
                    handleOnClick?.(id)
                }
            }}
            key={id}
            icon={(<>
                {active ? (
                    <AlexIcon icon={(
                        <svg width="48" height="72" viewBox="0 0 48 72" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_9_677204)">
                                <g clip-path="url(#clip1_9_677204)">
                                    <g clip-path="url(#clip2_9_677204)">
                                        <path
                                            d="M23.9999 69.92C26.3858 69.92 28.3199 67.9859 28.3199 65.6C28.3199 63.2142 26.3858 61.28 23.9999 61.28C21.6141 61.28 19.6799 63.2142 19.6799 65.6C19.6799 67.9859 21.6141 69.92 23.9999 69.92Z"
                                            fill="#BB88FF" stroke="white" stroke-width="2.24"/>
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                              d="M24 0C10.795 0 0 10.705 0 23.91C0 34.355 6.755 43.236 16.115 46.492C19.243 47.58 21.818 50.257 21.818 53.569V55.419C21.818 55.9977 22.0479 56.5527 22.4571 56.9619C22.8663 57.3711 23.4213 57.601 24 57.601C24.5787 57.601 25.1337 57.3711 25.5429 56.9619C25.9521 56.5527 26.182 55.9977 26.182 55.419V53.569C26.182 50.257 28.757 47.579 31.885 46.492C41.245 43.237 48 34.355 48 23.909C48 10.705 37.205 0 24 0Z"
                                              fill="#BB88FF"/>
                                        <circle cx="24" cy="24" r="8" fill="white"/>
                                    </g>
                                </g>
                            </g>
                            <defs>
                                <clipPath id="clip0_9_677204">
                                    <rect width="48" height="72" fill="white"/>
                                </clipPath>
                                <clipPath id="clip1_9_677204">
                                    <rect width="48" height="72" fill="white"/>
                                </clipPath>
                                <clipPath id="clip2_9_677204">
                                    <rect width="48" height="72" fill="white"/>
                                </clipPath>
                            </defs>
                        </svg>
                    )} width={'40px'}/>
                ) : (
                    <AlexIcon icon={(
                        <svg width="48" height="72" viewBox="0 0 48 72" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_9_677231)">
                                <path
                                    d="M24.0001 69.92C26.3859 69.92 28.3201 67.9859 28.3201 65.6C28.3201 63.2142 26.3859 61.28 24.0001 61.28C21.6142 61.28 19.6801 63.2142 19.6801 65.6C19.6801 67.9859 21.6142 69.92 24.0001 69.92Z"
                                    fill="#2F2F2F" stroke="white" stroke-width="2.24"/>
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                      d="M24 0C10.795 0 0 10.705 0 23.91C0 34.355 6.755 43.236 16.115 46.492C19.243 47.58 21.818 50.257 21.818 53.569V55.419C21.818 55.9977 22.0479 56.5527 22.4571 56.9619C22.8663 57.3711 23.4213 57.601 24 57.601C24.5787 57.601 25.1337 57.3711 25.5429 56.9619C25.9521 56.5527 26.182 55.9977 26.182 55.419V53.569C26.182 50.257 28.757 47.579 31.885 46.492C41.245 43.237 48 34.355 48 23.909C48 10.705 37.205 0 24 0Z"
                                      fill="#2F2F2F"/>
                                {EMarkerType.external === markerType && (
                                    <path
                                        d="M36.7964 21.1068L31.9934 15.5106C31.835 15.3214 31.637 15.1692 31.4134 15.0648C31.1898 14.9603 30.9461 14.9062 30.6993 14.9063H13.375C12.9274 14.9063 12.4982 15.084 12.1818 15.4005C11.8653 15.717 11.6875 16.1462 11.6875 16.5938V28.4063C11.6875 28.8538 11.8653 29.283 12.1818 29.5995C12.4982 29.916 12.9274 30.0938 13.375 30.0938H15.168C15.3538 30.8197 15.7761 31.4632 16.368 31.9227C16.96 32.3822 17.6881 32.6316 18.4375 32.6316C19.1869 32.6316 19.915 32.3822 20.507 31.9227C21.0989 31.4632 21.5212 30.8197 21.707 30.0938H26.9805C27.1663 30.8197 27.5886 31.4632 28.1805 31.9227C28.7725 32.3822 29.5006 32.6316 30.25 32.6316C30.9994 32.6316 31.7275 32.3822 32.3195 31.9227C32.9114 31.4632 33.3337 30.8197 33.5195 30.0938H35.3125C35.7601 30.0938 36.1893 29.916 36.5057 29.5995C36.8222 29.283 37 28.8538 37 28.4063V21.6563C37 21.4547 36.9278 21.2597 36.7964 21.1068ZM34.32 20.8125H28.5625V16.5938H30.6993L34.32 20.8125ZM20.9688 20.8125V16.5938H26.875V20.8125H20.9688ZM19.2813 16.5938V20.8125H13.375V16.5938H19.2813ZM18.4375 30.9375C18.1037 30.9375 17.7775 30.8385 17.5 30.6531C17.2225 30.4677 17.0062 30.2041 16.8785 29.8958C16.7507 29.5874 16.7173 29.2481 16.7824 28.9208C16.8475 28.5934 17.0083 28.2928 17.2443 28.0568C17.4803 27.8208 17.7809 27.66 18.1083 27.5949C18.4356 27.5298 18.7749 27.5632 19.0833 27.691C19.3916 27.8187 19.6552 28.035 19.8406 28.3125C20.026 28.59 20.125 28.9162 20.125 29.25C20.125 29.6976 19.9472 30.1268 19.6307 30.4432C19.3143 30.7597 18.8851 30.9375 18.4375 30.9375ZM30.25 30.9375C29.9162 30.9375 29.59 30.8385 29.3125 30.6531C29.035 30.4677 28.8187 30.2041 28.691 29.8958C28.5632 29.5874 28.5298 29.2481 28.5949 28.9208C28.66 28.5934 28.8208 28.2928 29.0568 28.0568C29.2928 27.8208 29.5934 27.66 29.9208 27.5949C30.2481 27.5298 30.5874 27.5632 30.8958 27.691C31.2041 27.8187 31.4677 28.035 31.6531 28.3125C31.8385 28.59 31.9375 28.9162 31.9375 29.25C31.9375 29.6976 31.7597 30.1268 31.4432 30.4432C31.1268 30.7597 30.6976 30.9375 30.25 30.9375ZM33.5195 28.4063C33.3337 27.6803 32.9114 27.0368 32.3195 26.5773C31.7275 26.1178 30.9994 25.8684 30.25 25.8684C29.5006 25.8684 28.7725 26.1178 28.1805 26.5773C27.5886 27.0368 27.1663 27.6803 26.9805 28.4063H21.707C21.5212 27.6803 21.0989 27.0368 20.507 26.5773C19.915 26.1178 19.1869 25.8684 18.4375 25.8684C17.6881 25.8684 16.96 26.1178 16.368 26.5773C15.7761 27.0368 15.3538 27.6803 15.168 28.4063H13.375V22.5H35.3125V28.4063H33.5195Z"
                                        fill="white"/>
                                )}
                            </g>
                            <defs>
                                <clipPath id="clip0_9_677231">
                                    <rect width="48" height="72" fill="white"/>
                                </clipPath>
                            </defs>
                        </svg>

                    )} width={'40px'}/>
                    )}
            </>)}
            position={[
                coordinates.lat,
                coordinates.lon,
            ]}/>
    )
}